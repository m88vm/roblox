<Directory /var/www/>
Options Indexes FollowSymLinks
AllowOverride All
Require all granted
</Directory>

#Включает отслеживание сим-ссылок
Options +FollowSymLinks
#Запускает url_rewriting
RewriteEngine On
#Блокирует все скрипты, которые пытаются изменить переменную _REQUEST:
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})

Order Deny, Allow
allow from all
#Список нежелательных IP адресов
deny from 31.28.96.0 31.28.127.255
deny from 37.1.128.0 37.1.143.255
deny from 37.131.192.0 37.131.223.255
deny from 94.190.0.0 94.190.127.255
deny from 178.211.160.0 178.211.191.255
deny from 185.17.16.0 185.17.19.255
deny from 217.28.72.0 217.28.79.255

deny from $black_list

$black_list = array(
	array('31.28.96.0', '31.28.127.255'),  
	array('37.1.128.0', '37.1.143.255'),  
	array('37.131.192.0', '37.131.223.255'),  
	array('94.190.0.0', '94.190.127.255'), 
	array('178.211.160.0', '178.211.191.255'), 
	
	array('185.17.16.0', '185.17.19.255'), 
	array('217.28.72.0', '217.28.79.255'),  

);
 
$ip = @ip2long($_SERVER['REMOTE_ADDR']);
foreach($black_list as $ips) {
	if ($ip >= @ip2long($ips[0]) && $ip <= @ip2long($ips[1])) {
		exit;
	}
}

$black_list = array(
	array('192.168.0.0', '192.168.255.255'),  
	array('172.16.0.0', '172.31.255.255'),  
);
 
$ip = @ip2long($_SERVER['REMOTE_ADDR']);
foreach($black_list as $ips) {
	if ($ip >= @ip2long($ips[0]) && $ip <= @ip2long($ips[1])) {
		exit;
	}
}


#Перечень User Agent-ов для блокировки:
SetEnvIfNoCase user-Agent ^FrontPage [NC,OR]
SetEnvIfNoCase user-Agent ^Java.* [NC,OR]
SetEnvIfNoCase user-Agent ^Microsoft.URL [NC,OR]
SetEnvIfNoCase user-Agent ^MSFrontPage [NC,OR]
SetEnvIfNoCase user-Agent ^Offline.Explorer [NC,OR]
SetEnvIfNoCase user-Agent ^[Ww]eb[Bb]andit [NC,OR]
SetEnvIfNoCase user-Agent ^Zeus [NC]

<limit get="" post="" head="">
Order Allow,Deny
Allow from all
Deny from env=bad_bot
</limit>


#Сжатие данных
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/html text/plain text/xml application/xml application/xhtml+xml text/javascript text/css application/x-javascript
BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4.0[678] no-gzip
BrowserMatch bMSIE !no-gzip !gzip-only-text/html
<ifmodule mod_gzip.c>
mod_gzip_on Yes
mod_gzip_item_include file \.js$
mod_gzip_item_include file \.css$ </ifmodule>
</IfModule> 

